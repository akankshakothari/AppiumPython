trigger:
- main

pool:
  vmImage: 'windows-latest'

variables:
  PYTHON_VERSION: '3.9'

steps:
- task: UsePythonVersion@0
  inputs:
    versionSpec: $(PYTHON_VERSION)
    addToPath: true
  displayName: "Set Python Version"

- script: |
    python -m pip install --upgrade pip
    pip install -r requirements.txt
  displayName: "Install Dependencies"

- script: |
    if not exist "$(Build.ArtifactStagingDirectory)\excel" mkdir "$(Build.ArtifactStagingDirectory)\excel"
    copy "$(System.DefaultWorkingDirectory)\path\to\your\testdata.xlsx" "$(Build.ArtifactStagingDirectory)\excel\testdata.xlsx"
  displayName: "Copy Test Data File"

- script: |
    echo "##vso[task.setvariable variable=PYTHONPATH]$(System.DefaultWorkingDirectory)"
  displayName: "Set PYTHONPATH"

- script: |
    pytest TestCases --junitxml=TestResults/test-results.xml
  displayName: "Run Tests with Pytest"

- task: PublishTestResults@2
  inputs:
    testResultsFiles: 'TestResults/test-results.xml'
    testRunTitle: 'AppiumPython Test Results'
  displayName: "Publish Test Results"
